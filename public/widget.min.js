(()=>{if("undefined"!=typeof window){let a={waitTime:{url:"https://bb-ui.dev.sg.salondev.net/api/v1/Widget/External/Waittime",method:"GET"},storeLink:{url:"https://bb-ui.dev.sg.salondev.net/api/v1/Widget/External/StoreLink",method:"GET"}},r='[data-widget="wait-time"]',n={Checkin:1,Booking:2},i=new Set;var e=document.createElement("style");e.textContent='[data-widget="wait-time"][data-use-default-styles="true"]{display:inline-flex;align-items:center;justify-content:center;height:35px;width:135px;cursor:default}[data-widget="wait-time"][data-use-default-styles="true"][data-has-time="true"]{color:#000;font-size:16px;background-color:#fff;border:1px solid #000;border-radius:30px;transition:all .2s ease;cursor:default}[data-widget="wait-time"][data-use-default-styles="true"][data-has-time="true"][data-clickable="true"]{cursor:pointer}[data-widget="wait-time"][data-use-default-styles="true"][data-has-time="true"][data-clickable="true"]:hover{background-color:#f5f5f5}',document.head.appendChild(e);let c={getCurrentDate(e="America/New_York"){var t=new Date,e=new Intl.DateTimeFormat("en-US",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(t);let a={};return e.forEach(e=>{"literal"!==e.type&&(a[e.type]=e.value)}),`${a.year}-${a.month}-${a.day}T00:00:00`},getCurrentTime(e="America/New_York"){var t=new Date,e=new Intl.DateTimeFormat("en-US",{timeZone:e,hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(t);let a={};return e.forEach(e=>{"literal"!==e.type&&(a[e.type]=e.value)}),`${a.hour.padStart(2,"0")}:${a.minute}:`+a.second},getCurrentWeekday(e="America/New_York"){var t=new Date,e=new Intl.DateTimeFormat("en-US",{timeZone:e}),e=new Date(e.format(t)).getDay();return 0===e?7:e}},o={async retryAsync(e,a="API Call"){let r=0,n=2e3;for(;r<3;)try{return await e()}catch(e){if(r++,console.warn(`${a} - Attempt ${r} failed: `+e.message),3<=r)throw console.error(a+" failed after 3 attempts."),e;let t=200*Math.random();console.log(`${a} - Retrying in ${n+t}ms...`),await new Promise(e=>setTimeout(e,n+t)),n*=2}},async fetchWaitTime(t){return this.retryAsync(async()=>{var e=await fetch(a.waitTime.url,{method:a.waitTime.method,headers:{Accept:"application/json","X-BookedBy-Widget-Context":t}});if(e.ok)return(await e.json()).response;throw new Error("HTTP error! status: "+e.status)},"Wait Time API Call")},async fetchStoreLink(t){return this.retryAsync(async()=>{var e=await fetch(a.storeLink.url,{method:a.storeLink.method,headers:{Accept:"application/json","X-BookedBy-Widget-Context":t}});if(e.ok)return{storeLink:(await e.json()).response};throw new Error("HTTP error! status: "+e.status)},"Store Link API Call")},async fetchWidgetData(e){let t=null;try{t=await this.fetchWaitTime(e)}catch(e){console.error("Failed to fetch wait time:",e)}let a=null;if(null!==t)try{var r=await this.fetchStoreLink(e);a=r.storeLink}catch(e){console.error("Failed to fetch store link:",e)}return{waitTimeData:t,storeLink:a}}},m={cleanupPollingInterval(e){var t=Number(e.dataset.intervalId);t&&(clearInterval(t),i.delete(t),delete e.dataset.intervalId)},cleanupAllPollingIntervals(){for(var e of i)clearInterval(e);i.clear()},cleanupWidgetAttributes(e){e.removeAttribute("data-has-time"),e.removeAttribute("data-clickable")},initializeWidgetAttributes(e,t=null){e.setAttribute("data-has-time","true"),e.role=t?"button":null,e.tabIndex=t?"0":null,e.onclick=t?()=>window.open(t,"_blank","noopener,noreferrer"):null,e.setAttribute("data-clickable",t?"true":"false")}},g={getOperationModeStatus(e,t){var a=Boolean((t||0)&n.Booking),t=Boolean((t||0)&n.Checkin),r=Boolean((e||0)&n.Booking),e=Boolean((e||0)&n.Checkin);return{isCheckinOnly:(!a||!r)&&t&&e}},getCurrentDaySchedule(t,e,a){a=a?.find(({date:e})=>e===t);if(a)return a;let r=c.getCurrentWeekday();return e?.find(e=>e.weekday===r)},formatWaitTime(e){var t;return e?([e,t]=e.split(":").map(Number),0<e?e+"h "+(0<t?t+"min":""):60*e+t+" min"):""},formatToUSTime(e){var t,a;return e?([e,t]=e.split(":").map(Number),a=12<=e?"PM":"AM",`${e%12||12}:${t.toString().padStart(2,"0")} `+a):""},getStatusString(e,t,a){var{isOpen:e,closedAtDate:r,closedAlready:n,beforeOpen:i,onBreak:o}=e;return r||n?"Closed":i?"Opens "+g.formatToUSTime(t[0].start):o?"Opens "+g.formatToUSTime(t[1].start):e&&!a?"Unavailable":""},getStoreScheduleMetadata(e,t){function a(e){var[e,t,a]=e.split(":").map(Number);return 3600*e+60*t+a}let r=a(t);var t=e.find(({start:e,end:t})=>{e=a(e),t=a(t);return r>=e&&r<=t}),n=!!t;return{isOpen:n,beforeOpen:!n&&e[0]&&r<a(e[0].start),closingSoon:t&&a(t.end)-r<=3600,onBreak:2===e.length&&r>=a(e[0].end)&&r<=a(e[1].start),closedAtDate:0===e.length,closedAlready:0<e.length&&r>a(e[e.length-1].end),currentInterval:t||null}},updateWidgetContent(e,t){var a,r,n,i,o,l,d,s,u;t&&t.waitTime&&t.schedule?({waitTime:{waitTime:t,existsAvailableProvider:a,reason:r},schedule:{weeklySchedule:d,scheduleExceptions:s},storeTimeZone:o,operatingMode:n,bookingGroupOperationMode:i}=t,o?(l=c.getCurrentDate(o),o=c.getCurrentTime(o),{fromTime1:l,toTime1:d,fromTime2:s,toTime2:u}=g.getCurrentDaySchedule(l,d,s),l=[{start:l,end:d},{start:s,end:u}].filter(e=>!!e.start&&!!e.end),d=g.getStoreScheduleMetadata(l,o),s=g.getOperationModeStatus(n,i).isCheckinOnly,s?((u=g.getStatusString(d,l,a))||m.cleanupWidgetAttributes(e),e.textContent=u):d.isOpen&&6===r&&t?e.textContent=g.formatWaitTime(t)+" wait":m.cleanupWidgetAttributes(e)):(console.warn("Store timezone not provided"),m.cleanupWidgetAttributes(e),e.textContent="")):(console.warn("No wait time data found"),m.cleanupWidgetAttributes(e),e.textContent="")}};document.addEventListener("DOMContentLoaded",async function(){function t(){(document.querySelectorAll('[data-widget="wait-time"]:not([data-initialized="true"])')||[]).forEach(e=>{var t=e.getAttribute("data-token");t?(async(t,a)=>{if("true"!==t.dataset.initialized){t.dataset.intervalId&&m.cleanupPollingInterval(t);try{var e,r=await o.fetchWidgetData(a);r.waitTimeData&&(t.dataset.initialized="true",m.initializeWidgetAttributes(t,r.storeLink),g.updateWidgetContent(t,r.waitTimeData),e=setInterval(async()=>{try{var e=await o.fetchWaitTime(a);e&&g.updateWidgetContent(t,e)}catch(e){e?.response?.userMessage?console.error("Error updating widget data:",e.response.userMessage):console.error("Error updating widget data:",e),m.cleanupPollingInterval(t)}},3e5),t.dataset.intervalId=e,i.add(e))}catch(e){m.cleanupWidgetAttributes(t),t.textContent="",t.dataset.intervalId&&m.cleanupPollingInterval(t),e?.response?.userMessage?console.error("Unexpected error in updateWidget:",e.response.userMessage):console.error("Unexpected error in updateWidget:",e.message,e)}}})(e,t):console.error("Widget token not found")})}(document.querySelectorAll(r)||[]).length||console.error("No wait time widgets found"),t();{let e=new MutationObserver(e=>{e.some(e=>"childList"===e.type&&(e.removedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(e.querySelectorAll(r).forEach(m.cleanupPollingInterval),e.matches(r))&&m.cleanupPollingInterval(e)}),Array.from(e.addedNodes).some(e=>1===e.nodeType&&(e.matches(r)||e.querySelector(r)))))&&t()});e.observe(document.body,{childList:!0,subtree:!0}),window.addEventListener("unload",()=>{e.disconnect(),m.cleanupAllPollingIntervals()})}})}})();